# 服务器端配置

**服务器**: RackNerd (172.245.19.104)  
**系统**: Ubuntu/Debian

---

## 服务管理

### 登录服务器

```bash
sshpass -p '21X16nPF3oWL4mhwRa' ssh -o StrictHostKeyChecking=no root@172.245.19.104
```

### 服务状态

```bash
# 查看 xray 状态
systemctl status xray

# 查看 nginx 状态
systemctl status nginx

# 重启 xray
systemctl restart xray

# 重启 nginx
systemctl restart nginx
```

---

## 端口监听

| 端口 | 协议 | 用途 |
|------|------|------|
| 443 | VLESS + Reality | Shadowrocket (Cloudflare) |
| 8443 | VLESS + Reality | Shadowrocket (Microsoft) |
| 2053 | VLESS + TLS | Clash (Google) |
| 10443 | VLESS + TLS | Clash (Cloudflare) |
| 2096 | VLESS + TLS | Clash (Microsoft) |
| 12086 | VLESS + TLS | Clash (Apple) |
| 10000 | VMess + WebSocket | Clash (WebSocket) |
| 8888 | HTTP | Clash 订阅服务 |

---

## 配置文件位置

| 文件 | 路径 |
|------|------|
| Xray 配置 | `/etc/xray/config.json` |
| Clash 订阅 | `/var/www/html/clash.yaml` |
| SSL 证书 | `/etc/xray/cert.pem`, `/etc/xray/key.pem` |
| Nginx 配置 | `/etc/nginx/nginx.conf` |

---

## Xray 配置详情

### 当前 inbound 配置

```json
{
  "inbounds": [
    {
      "port": 443,
      "protocol": "vless",
      "tag": "Cloudflare-443-Real",
      "settings": {
        "clients": [{
          "id": "cbf3b4be-b3a8-4f70-bd28-988e72f7d46d",
          "flow": "xtls-rprx-vision"
        }]
      },
      "streamSettings": {
        "network": "tcp",
        "security": "reality",
        "realitySettings": {
          "dest": "www.cloudflare.com:443",
          "serverNames": ["www.cloudflare.com"],
          "privateKey": "wOPlZdifmB3uSkziGR8LQ-Bz-bxxFZdBGbVIIj9x50A",
          "shortIds": ["590b3501"]
        }
      }
    },
    {
      "port": 8443,
      "protocol": "vless",
      "tag": "Microsoft-8443-Real",
      "settings": {...},
      "streamSettings": {
        "network": "tcp",
        "security": "reality",
        "realitySettings": {
          "dest": "www.microsoft.com:443",
          "serverNames": ["www.microsoft.com", "www.bing.com"],
          ...
        }
      }
    },
    {
      "port": 2053,
      "protocol": "vless",
      "tag": "TLS-2053",
      "streamSettings": {
        "network": "tcp",
        "security": "tls",
        "tlsSettings": {
          "certificates": [{
            "certificateFile": "/etc/xray/cert.pem",
            "keyFile": "/etc/xray/key.pem"
          }]
        }
      }
    },
    {
      "port": 10000,
      "protocol": "vmess",
      "tag": "WebSocket-10000",
      "streamSettings": {
        "network": "ws",
        "wsSettings": {
          "path": "/v2ray"
        }
      }
    }
  ]
}
```

### 核心参数

| 参数 | 值 |
|------|-----|
| UUID | cbf3b4be-b3a8-4f70-bd28-988e72f7d46d |
| Private Key | wOPlZdifmB3uSkziGR8LQ-Bz-bxxFZdBGbVIIj9x50A |
| Public Key | vQHFkbVqbMIHkMSIAKiaHK5PwIiIlJmKZPbWTtZqBX8 |
| Short ID | 590b3501 |

---

## 更新配置

### 更新 Xray 配置

```bash
# 编辑配置
vim /etc/xray/config.json

# 或直接写入
cat > /etc/xray/config.json << 'JSON'
{...}
JSON

# 重启服务
systemctl restart xray
```

### 更新 Clash 订阅

```bash
# 编辑订阅
vim /var/www/html/clash.yaml

# 或直接写入
cat > /var/www/html/clash.yaml << 'YAML'
{...}
YAML

# 重启 nginx
systemctl restart nginx
```

---

## 常用命令

```bash
# 查看端口监听
ss -tlnp | grep -E 'xray|nginx'

# 查看 Xray 日志
journalctl -u xray -f

# 测试订阅是否可访问
curl http://172.245.19.104:8888/clash.yaml

# 检查配置语法
xray -test -config /etc/xray/config.json
