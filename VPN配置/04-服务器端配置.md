# 服务器端配置

**服务器**: RackNerd (172.245.19.104)  
**系统**: Ubuntu 22.04 (6.8.0-31-generic)  
**Xray**: 25.8.3  
**最后更新**: 2026-02-15

---

## 服务管理

### 登录服务器

```bash
sshpass -p '21X16nPF3oWL4mhwRa' ssh -o StrictHostKeyChecking=no root@172.245.19.104
```

### 服务状态

```bash
# 查看 xray 状态
systemctl status xray

# 查看 nginx 状态
systemctl status nginx

# 查看 WARP 状态
warp-cli status

# 重启 xray
systemctl restart xray

# 重启 nginx
systemctl restart nginx
```

---

## 端口监听

| 端口 | 协议 | 用途 | 出站 |
|------|------|------|------|
| 443 | VLESS + Reality | Shadowrocket (Cloudflare) | WARP |
| 8443 | VLESS + Reality | Shadowrocket (Microsoft) | WARP |
| 2083 | VLESS + Reality | Shadowrocket (Google) | WARP |
| 2087 | VLESS + Reality | Shadowrocket (Apple) | WARP |
| 11000 | VLESS + WS + TLS | Shadowrocket (WebSocket) | WARP |
| 2053 | VLESS + TLS | Clash (Google) | WARP |
| 10443 | VLESS + TLS | Clash (Cloudflare) | WARP |
| 2096 | VLESS + TLS | Clash (Microsoft) | WARP |
| 12086 | VLESS + TLS | Clash (Apple) | WARP |
| 12000 | VLESS + WS + TLS | Clash (WebSocket) | WARP |
| 8888 | HTTP | Clash 订阅服务 (nginx) | - |
| 40000 | SOCKS5 | WARP 本地代理 | - |

---

## 配置文件位置

| 文件 | 路径 |
|------|------|
| Xray 配置 | `/etc/xray/config.json` |
| Clash 订阅 | `/var/www/html/clash.yaml` |
| SSL 证书 | `/etc/xray/cert.pem` (CN=cloudflare.com, 有效期至 2027-02-14) |
| SSL 密钥 | `/etc/xray/key.pem` |
| Nginx 配置 | `/etc/nginx/nginx.conf` |
| Xray 配置备份 | `/etc/xray/config.json.bak.*` |

---

## WARP 配置

### 工作模式

WARP 运行在 **proxy** 模式，监听 `127.0.0.1:40000` (SOCKS5)。
Xray 所有出站流量通过此 SOCKS5 代理转发至 Cloudflare 网络。

### WARP 管理命令

```bash
# 查看状态
warp-cli status

# 断开/重连
warp-cli disconnect
warp-cli connect

# 测试 WARP IP
curl -x socks5h://127.0.0.1:40000 https://api.ipify.org

# 测试直连 IP
curl https://api.ipify.org
```

---

## Xray 配置详情

### 出站链路

```
所有 Inbound → WARP SOCKS5 (127.0.0.1:40000) → Cloudflare → 目标网站
```

### 核心参数

| 参数 | 值 |
|------|-----|
| UUID | cbf3b4be-b3a8-4f70-bd28-988e72f7d46d |
| Private Key | wOPlZdifmB3uSkziGR8LQ-Bz-bxxFZdBGbVIIj9x50A |
| Public Key | vQHFkbVqbMIHkMSIAKiaHK5PwIiIlJmKZPbWTtZqBX8 |
| Short ID | 590b3501 |
| connIdle | 300 秒 |

---

## 更新配置

### 更新 Xray 配置

```bash
# 编辑配置
vim /etc/xray/config.json

# 测试配置语法
xray -test -config /etc/xray/config.json

# 重启服务
systemctl restart xray
```

### 更新 Clash 订阅

```bash
# 编辑订阅
vim /var/www/html/clash.yaml

# 重启 nginx
systemctl restart nginx
```

---

## 常用命令

```bash
# 查看端口监听
ss -tlnp | grep -E 'xray|nginx'

# 查看 Xray 日志
journalctl -u xray -f

# 测试订阅是否可访问
curl http://172.245.19.104:8888/clash.yaml

# 检查配置语法
xray -test -config /etc/xray/config.json

# 查看 WARP 出站 IP
curl -x socks5h://127.0.0.1:40000 https://ipinfo.io
```
