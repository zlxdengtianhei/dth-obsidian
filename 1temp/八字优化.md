根据代码和prompts，用神有两个主要作用：

### 1. 调候用神（穷通宝鉴法）

作用：调节气候，平衡寒热燥湿

- 原理：不同日干在不同月份需要不同的气候条件

- 示例：

- 甲木生于正月（寅月）：初春有馀寒，需要丙火温暖、癸水滋润

- 丙火生于午月：夏季火旺，需要壬水降温

- 判断标准：命局是否具备调候所需的五行

### 2. 平衡用神（子平法）

作用：平衡五行力量，调节身旺身弱

- 原理：根据日主旺衰确定需要的五行

- 规则：

- 身旺：喜克（官杀）、泄（食伤）、耗（财）

- 身弱：喜生（印绶）、扶（比劫）

- 代码实现：YongshenExtractor.extract() 中已有逻辑

### 3. 最终用神（综合判定）

作用：综合调候和平衡，确定命局最需要的五行

- 处理冲突：当调候和平衡冲突时，需要说明处理原则

- 配备检查：检查命局是否具备用神，缺则说明影响

- 用途：

- 判断格局层次（配方齐全/缺失）

- 确定喜忌大运（喜用神运，忌忌神运）

- 分析性格特点（根据五行配置）

### 用神在系统中的使用流程

1. 提取用神建议 (YongshenExtractor)

   ├─ 平衡用神（代码计算）

   └─ 调候查询参数（准备RAG查询）

2. RAG查询调候用神 (BaziRetriever)

   └─ 查询穷通宝鉴获取调候配方

3. LLM综合解读 (yueling_yongshen.py)

   ├─ 调候配方检查

   ├─ 平衡用神分析

   ├─ 冲突处理

   └─ 最终用神确定

4. 应用用神

   ├─ 判断格局层次

   ├─ 确定喜忌大运

   └─ 分析性格特点

## 总结

1. 用神能否代码化：

- 平衡用神：可以（已有代码）

- 调候用神：部分可以（24个组合可做查找表），大部分需要RAG查询

1. 用神的作用：

- 调候用神：调节气候（寒热燥湿）

- 平衡用神：平衡五行力量（身旺身弱）

- 最终用神：综合判定，用于判断格局层次、确定喜忌大运、分析性格

建议：将24个有明确配方的组合做成查找表，作为快速路径；其他组合继续使用RAG查询作为慢速路径。

给llm的查询结果就是针对两种来说明。
另外得看一下，这个用神是否还有对其他的类型的影响

