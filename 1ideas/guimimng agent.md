接入soul的语音模型，提供更加真实的占卜体验

对于不同的问题，使用不同的prompt，这些prompt对应的位置是在向量数据库定义，根据用户输入来匹配

**Graph RAG**：不仅仅从非结构化文本中检索，还结合知识图谱（Knowledge Graph）。当问题涉及到复杂的实体和关系时，系统可以从知识图谱中检索出结构化的“事实三元组”（如`[北京 - 首都 - 中国]`），并将其与文本块一起提供给LLM。这对于需要推理和多跳问答的场景特别有效。


找一下，得到soul 的用户数据的可能性，尝试进行人的兴趣的匹配

如何处理高并发请求


卡牌信息还是用本地数据库，或者考虑如何优化rag搜索时间。继续优化一下prompt

## 交互 #2: 模式分析 (pattern_analysis)

  

**模型**: gpt-4o-mini

**温度**: 0.5

  

**Prompt**:

```

你是一位经验丰富的塔罗占卜师。请分析以下牌阵的模式和关系。

  

## 占卜方式：three_card

## 问题领域：general

  

## 牌阵信息：

1. past (过去的影响): Four of Cups (四 圣杯) - cups 4

2. present (当前状况): Five of Swords (五 宝剑) - swords 5

3. future (未来趋势): King of Pentacles (国王 星币) - pentacles 14

  

## 分析要求：

1. **位置关系**：分析各位置之间的关系（时间线、因果、支持/对抗）

2. **数字模式**：识别相同数字、数字序列、数字跳跃

3. **花色分布**：分析各花色的分布和平衡

4. **大阿卡纳模式**：分析大阿卡纳的位置和意义

5. **逆位模式**：分析逆位牌的模式和含义

6. **特殊组合**：识别宫廷牌组合、相同牌等特殊模式

```

  

**LLM响应**:

```json

{

"position_relationships": {

"time_flow": "过去的四圣杯代表了对情感的沉思和不满，影响了当前的五宝剑局面，表明了一种内心的冲突和争斗，而未来的国王星币则暗示着通过努力和稳重的态度，能够实现物质上的成功和稳定。",

"causal_relationships": [

"四圣杯→五宝剑: 过去的情感不满导致了当前的冲突和竞争。",

"五宝剑→国王星币: 当前的冲突如果妥善处理，将为未来的成功奠定基础。"

],

"support_conflict": "四圣杯的内心反思与五宝剑的外部冲突形成对抗，而国王星币则提供了支持，通过稳重和成熟的管理来解决当前的纷争。"

},

"number_patterns": {

"same_numbers": [],

"number_sequences": [],

"number_jumps": ["4到5的跳跃，表明从内心的情感状态到外部的冲突变化。"]

},

"suit_distribution": {

"wands_count": 0,

"cups_count": 1,

"swords_count": 1,

"pentacles_count": 1,

"major_count": 0,

"interpretation": "当前牌阵中三种花色均有出现，显示出情感、冲突和物质的平衡，暗示需要在这几个方面找到协调。"

},

"major_arcana_patterns": {

"count": 0,

"positions": [],

"meaning": "没有大阿卡纳牌，表明当前的情况主要受小阿卡纳的影响，强调日常生活中的实际问题。"

},

"reversed_patterns": {

"count": 0,

"positions": [],

"interpretation": "没有逆位牌，表示当前状况较为正面，未出现明显的阻碍或负面影响。"

},

"special_combinations": []

}

```

  

**评估**: ⚠️ **存在问题** - 对五宝剑的解读过于乐观。五宝剑是一张非常负面的牌，不应该被解读为"较为正面"。

  

这部分要使用本地模型


gemini对于算法相关的设计是最好的，然后claude的工程化实现更好



对于graphrag，以及记忆，可以维护一个对结果的分析的功能，对这个问题进行收集，记录具体属于那个方面的问题，然后更新数据库，可以实现一个一直进化的效果

记录用户的反馈，然后可以用来维护rag


八字需要看一下，这几个rag查询到底应该查哪些书，还是说直接查就行

六爻的旅行相关问题，是不是真的一直用神不显

六爻这个分析用户的里面要说到底增删卜易有哪些章节

把八字和六爻的架构设计更新，并且放在更小分割的文档

把prompt管理，以及使用模型管理优化一下


在rag数据库实现时，要针对不同的问题，看看原始的数据中，是有明确对应的答案，还是说是

---
注意检查一下每次召回的条目数量，以及搜索策略
注意仔细思考一下测试，是如何进行的。还有测试具体是怎么进行的，chunk具体是怎么构建的

---
/Users/lexuanzhang/code/tarot_agent/子平平衡用神优化完整实施报告.md
对于子平，后续两个子平，滴天髓层很一般，另外这个bazi的数据库可能又一些隔离的问题。

之前的使用/Users/lexuanzhang/code/tarot_agent/穷通宝鉴调候用神优化完整实施报告.md这个优化方案完成了针对性的修改，对穷通的内容进行了详细的优化


----
然后，需要给所有的查询添加去重

---
之后要详细的确定一下bazi解读的流程到底是什么，然后格局应该是确实首先要得到的信息之一，后续查询用神也需要

---
这个jsonb到底是干啥的，这个metadata为什么需要使用这个

---
具体的流程来说，是不是应该先进行时日断，以及日干月令的处理，然后看格局，然后看用神？


---
如果说一个针对各种文档进行rag构建的，首先套一个整体分析，使用大窗口llm，然后决定一下如何分类这些数据，确定一下标签，然后使用一个确定能够针对合理的chunk size，以及合适的输入size，针对几个chunk（取决于llm输入size）打上标签。

还有就是针对数据如何进行分割，如何进行chunk分割，结合输出token的价格