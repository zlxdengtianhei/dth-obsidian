# 拆解：OpenClaw就是agent记忆的最佳范式！其逻辑与RAG有何区别？

> 来源：https://mp.weixin.qq.com/s/leRHk1XxOqzt0wLJoDdB0Q

---

## 关键一环：agent怎么记起内容

每次会话的必做步骤：

1. 读取SOUL.md文件——定义智能体的自身定位
2. 读取USER.md文件——明确服务的用户信息
3. 读取memory目录下今日和昨日的日志文件——获取近期上下文
4. 若为「主会话」（与用户的直接聊天），额外读取MEMORY.md——获取长期记忆

**无需向用户申请权限，直接执行即可。**

---

## 记忆检索：混合检索 + 自动索引

随着使用时间变长，记忆文件会越来越多，要是没有索引，检索起来会越来越慢。Clawdbot设计了自动索引构建功能，只要你保存了任意一个记忆文件（不管是智能体自动写入还是手动编辑），系统都会在后台自动触发索引构建流程，确保新内容能被快速检索。

### 混合检索机制

文本块采用重叠策略：
- 文本块1：第1-15行 → 与文本块2重叠80个token
- 文本块2：第12-28行 → 与文本块3重叠80个token
- 文本块3：第25-40行

**最终得分 = 0.7 × 向量检索得分 + 0.3 × 关键词检索得分**

这样的混合检索方式，既能匹配语义相近的抽象内容（比如"关于数据库的相关讨论"），又能精准捕捉人名、编号、日期这类具体信息（比如某人哪天提了什么信息）。

---

## 多智能体记忆的隔离与管理

```
~/.clawdbot/memory/ # 索引存储目录
├── main.sqlite # 「主智能体」的向量索引
└── work.sqlite # 「工作智能体」的向量索引

~/clawd/ # 「主智能体」的工作目录（记忆源文件）
├── MEMORY.md
└── memory/
    └── 2026-01-26.md

~/clawd-work/ # 「工作智能体」的工作目录（记忆源文件）
├── MEMORY.md
└── memory/
    └── 2026-01-26.md
```

**默认情况下，每个agent只能访问自己的记忆，无法读取其他agent的内容；除非你没开启严格沙箱模式，否则不会出现记忆串用的情况。**

---

## 历史信息过多时：自动压缩

```json
{
  "agents": {
    "defaults": {
      "compaction": {
        "reserveTokensFloor": 20000,
        "memoryFlush": {
          "enabled": true,
          "softThresholdTokens": 4000,
          "systemPrompt": "会话即将触发压缩，请立即存储需要长期保留的记忆。",
          "prompt": "将需要长期记录的内容写入memory/YYYY-MM-DD.md，若无相关内容，回复NO_REPLY。"
        }
      }
    }
  }
}
```

---

## 冗余信息太多：智能裁剪

```json
{
  "agent": {
    "contextPruning": {
      "mode": "cache-ttl", // 仅在缓存过期后执行裁剪
      "ttl": "600", // 与模型的缓存有效期保持一致（单位：秒）
      "keepLastAssistants": 3, // 保留最近3次智能体的工具执行结果
      "softTrim": {
        "maxChars": 4000,
        "headChars": 1500,
        "tailChars": 1500
      },
      "hardClear": {
        "enabled": true,
        "placeholder": "[旧工具执行结果已清空]"
      }
    }
  }
}
```

---

## 与传统RAG的区别

1. **主动记忆 vs 被动检索**：传统RAG是被动检索知识库，而OpenClaw是主动记忆上下文
2. **会话级记忆**：每个会话有独立的memory文件，会话结束后可继续使用
3. **自动索引**：无需手动建立索引，系统自动后台构建
4. **多智能体隔离**：每个agent有独立的记忆存储，确保隐私不泄露
5. **智能压缩**：根据token使用情况自动触发记忆压缩

---

## 用户偏好（长期记忆示例）

- **编程语言**：更倾向TypeScript
- **内容需求**：喜欢简洁的解释说明
- **正在推进的项目**：Acme数据看板

### 重要决策

- 2026-01-15：数据库选用milvus
- 2026-01-20：API架构采用REST而非GraphQL
- 2026-01-26：样式开发使用Tailwind CSS

### 核心联系人

- 艾丽斯（alice@xxx.com）：设计负责人
- 鲍勃（bob@xxx.com）：后端工程师

---

*保存时间：2026-02-14*
