Traceback (most recent call last):                                                                                                                                                                                                                                 
  File "/home/ik2200-2025-g1/lexuan/stc/main.py", line 29, in <module>                                                                                                                                                                                             
    model.train(                                                                                                                                                                                                                                                   
  File "/home/ik2200-2025-g1/lexuan/stc/stitchllm.py", line 247, in train                                                                                                                                                                                          
    train_result = trainer.train()                                                                                                                                                                                                                                 
                   ^^^^^^^^^^^^^^^                                                                                                                                                                                                                                 
  File "/home/ik2200-2025-g1/lexuan/stc/.venv/lib/python3.12/site-packages/transformers/trainer.py", line 2328, in train                                                                                                                                           
    return inner_training_loop(                                                                                                                                                                                                                                    
           ^^^^^^^^^^^^^^^^^^^^                                                                                                                                                                                                                                    
  File "/home/ik2200-2025-g1/lexuan/stc/.venv/lib/python3.12/site-packages/transformers/trainer.py", line 2672, in _inner_training_loop                                                                                                                            
    tr_loss_step = self.training_step(model, inputs, num_items_in_batch)                                                                                                                                                                                           
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^                                                                                                                                                                                           
  File "/home/ik2200-2025-g1/lexuan/stc/.venv/lib/python3.12/site-packages/transformers/trainer.py", line 4009, in training_step                                                                                                                                   
    loss = self.compute_loss(model, inputs, num_items_in_batch=num_items_in_batch)                                                                                                                                                                                 
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^                                                                                                                                                                                 
  File "/home/ik2200-2025-g1/lexuan/stc/.venv/lib/python3.12/site-packages/transformers/trainer.py", line 4099, in compute_loss                                                                                                                                    
    outputs = model(**inputs)                                                                                                                                                                                                                                      
              ^^^^^^^^^^^^^^^                                                                                                                                                                                                                                      
  File "/home/ik2200-2025-g1/lexuan/stc/.venv/lib/python3.12/site-packages/torch/nn/modules/module.py", line 1773, in _wrapped_call_impl                                                                                                                           
    return self._call_impl(*args, **kwargs)                                                                                                                                                                                                                        
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^                                                                                                                                                                                                                        
  File "/home/ik2200-2025-g1/lexuan/stc/.venv/lib/python3.12/site-packages/torch/nn/modules/module.py", line 1784, in _call_impl                                                                                                                                   
    return forward_call(*args, **kwargs)                                                                                                                                                                                                                           
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^                                                                                                                                                                                                                           
  File "/home/ik2200-2025-g1/lexuan/stc/.venv/lib/python3.12/site-packages/accelerate/utils/operations.py", line 818, in forward                                                                                                                                   
    return model_forward(*args, **kwargs)                                                                                                                                                                                                                          
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^                                                                                                                                                                                                                          
  File "/home/ik2200-2025-g1/lexuan/stc/.venv/lib/python3.12/site-packages/accelerate/utils/operations.py", line 806, in __call__                                                                                                                                  
    return convert_to_fp32(self.model_forward(*args, **kwargs))                                                                                                                                                                                                    
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^                                                                                                                                                                                                     
  File "/home/ik2200-2025-g1/lexuan/stc/.venv/lib/python3.12/site-packages/torch/amp/autocast_mode.py", line 44, in decorate_autocast                                                                                                                              
    return func(*args, **kwargs)                                                                                                                                                                                                                                   
           ^^^^^^^^^^^^^^^^^^^^^                                                                                                                                                                                                                                   
  File "/home/ik2200-2025-g1/lexuan/stc/stitchllm.py", line 532, in forward                                                                                                                                                                                        
    hidden_states = layer(                                                                                                                                                                                                                                         
                    ^^^^^^                                                                                                                                                                                                                                         
  File "/home/ik2200-2025-g1/lexuan/stc/.venv/lib/python3.12/site-packages/transformers/modeling_layers.py", line 94, in __call__                                                                                                                                  
    return super().__call__(*args, **kwargs)                                                                                                                                                                                                                       
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^                                                                                                                                                                                                                       
  File "/home/ik2200-2025-g1/lexuan/stc/.venv/lib/python3.12/site-packages/torch/nn/modules/module.py", line 1773, in _wrapped_call_impl                                                                                                                           
    return self._call_impl(*args, **kwargs)                                                                                                                                                                                                                        
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^                                                                                                                                                                                                                        
  File "/home/ik2200-2025-g1/lexuan/stc/.venv/lib/python3.12/site-packages/torch/nn/modules/module.py", line 1784, in _call_impl                                                                                                                                   
    return forward_call(*args, **kwargs)                                                                                                                                                                                                                           
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^                                                                                                                                                                                                                           
  File "/home/ik2200-2025-g1/lexuan/stc/.venv/lib/python3.12/site-packages/transformers/utils/deprecation.py", line 172, in wrapped_func                                                                                                                           
    return func(*args, **kwargs)                                                                                                                                                                                                                                   
           ^^^^^^^^^^^^^^^^^^^^^                                                                                                                                                                                                                                   
  File "/home/ik2200-2025-g1/lexuan/stc/.venv/lib/python3.12/site-packages/transformers/models/qwen2/modeling_qwen2.py", line 234, in forward                                                                                                                      
    hidden_states, _ = self.self_attn(                                                                                                                                                                                                                             
                       ^^^^^^^^^^^^^^^                                                                                                                                                                                                                             
  File "/home/ik2200-2025-g1/lexuan/stc/.venv/lib/python3.12/site-packages/torch/nn/modules/module.py", line 1773, in _wrapped_call_impl                                                                                                                           
    return self._call_impl(*args, **kwargs)                                                                                                                                                                                                                        
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^                                                                                                                                                                                                                        
  File "/home/ik2200-2025-g1/lexuan/stc/.venv/lib/python3.12/site-packages/torch/nn/modules/module.py", line 1784, in _call_impl                                                                                                                                   
    return forward_call(*args, **kwargs)                                                                                                                                                                                                                           
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^                                                                                                                                                                                                                           
  File "/home/ik2200-2025-g1/lexuan/stc/.venv/lib/python3.12/site-packages/transformers/utils/deprecation.py", line 172, in wrapped_func                                                                                                                           
    return func(*args, **kwargs)                                                                                                                                                                                                                                   
           ^^^^^^^^^^^^^^^^^^^^^                                                                                                                                                                                                                                   
  File "/home/ik2200-2025-g1/lexuan/stc/.venv/lib/python3.12/site-packages/transformers/models/qwen2/modeling_qwen2.py", line 169, in forward
    attn_output, attn_weights = attention_interface(                                                                             
                                ^^^^^^^^^^^^^^^^^^^^                                                                             
  File "/home/ik2200-2025-g1/lexuan/stc/.venv/lib/python3.12/site-packages/transformers/integrations/sdpa_attention.py", line 83, in sdpa_attention_forward
    attn_output = torch.nn.functional.scaled_dot_product_attention(
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: Expected attn_mask dtype to be bool or float or to match query dtype, but got attn_mask.dtype: long int and  query.dtype: c10::BFloat16 instead.
  0%|                        