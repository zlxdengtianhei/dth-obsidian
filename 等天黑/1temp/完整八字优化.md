# 八字解读方法系统化整合实施计划（V2修订版）

## 项目概述

### 目标

构建一个准确、全面、成本优化的八字解读系统，整合四部经典命理文献的解读方法，通过RAG技术实现智能查询和综合解读。

### 核心原则

- **完整性优先**：完整阅读原文，不遗漏重要方法
- **精确性保证**：所有方法都有明确的原文依据
- **架构驱动**：RAG设计基于解读架构，不是独立设计
- **批判性审查**：每个阶段都有多重review机制
- **自动化流程**：通过Supervisor Agent实现自动化执行和阶段转换

### 源文件路径

#### 完整版原文

- `/Users/lexuanzhang/code/tarot_agent/database/chinese_extracted_books/三命通會/`
- `/Users/lexuanzhang/code/tarot_agent/database/chinese_extracted_books/淵海子平/`
- `/Users/lexuanzhang/code/tarot_agent/database/chinese_extracted_books/滴天髓闡微/`
- `/Users/lexuanzhang/code/tarot_agent/database/chinese_extracted_books/窮通寶鑒/`

#### 精炼版文档

- `/Users/lexuanzhang/code/tarot_agent/database/chinese_book_analysis/解读方法/三命通會_精炼版.md`
- `/Users/lexuanzhang/code/tarot_agent/database/chinese_book_analysis/解读方法/淵海子平_精炼版.md`
- `/Users/lexuanzhang/code/tarot_agent/database/chinese_book_analysis/解读方法/滴天髓闡微_精炼版.md`
- `/Users/lexuanzhang/code/tarot_agent/database/chinese_book_analysis/解读方法/窮通寶鑒_精炼版.md`

#### 完整解读方法

- `/Users/lexuanzhang/code/tarot_agent/database/chinese_book_analysis/解读方法/三命通會.md`
- `/Users/lexuanzhang/code/tarot_agent/database/chinese_book_analysis/解读方法/淵海子平.md`
- `/Users/lexuanzhang/code/tarot_agent/database/chinese_book_analysis/解读方法/滴天髓闡微.md`
- `/Users/lexuanzhang/code/tarot_agent/database/chinese_book_analysis/解读方法/窮通寶鑒.md`

#### 参考文档

- `/Users/lexuanzhang/code/tarot_agent/四本八字经典书籍排盘信息比较分析.md`

---

## Supervisor Agent设计

### Supervisor Agent职责

**核心功能**：

1. 顺序执行6个Phase的所有agents
2. 监控每个agent的执行状态
3. 收集agent输出并验证完整性
4. 触发review agents进行质量检查
5. 根据review结果决定是否通过或重新执行
6. 自动进入下一个Phase
7. 生成最终项目报告

### 执行流程

### 状态管理

Supervisor维护项目状态文件：`project_state.json`

{

  "project_name": "八字解读方法系统化整合",

  "start_time": "2026-01-29T00:00:00Z",

  "current_phase": "Phase 1",

  "current_agent": "Agent 1",

  "phases": {

    "Phase 1": {

      "status": "in_progress",

      "agents_completed": [],

      "agents_failed": [],

      "review_status": "pending",

      "pass": null,

      "reports": []

    },

    "Phase 2": {"status": "pending"},

    "Phase 3": {"status": "pending"},

    "Phase 4": {"status": "pending"},

    "Phase 5": {"status": "pending"},

    "Phase 6": {"status": "pending"}

  },

  "total_agents_executed": 0,

  "total_agents_planned": 41,

  "retry_count": {}

}

---

## Phase 1: 解读方法完整性验证（完整版与原文对照）

### 目标

完整阅读原文，检查完整版解读方法文档是否准确、完整、清晰。这是基础工作，确保完整版文档正确后，才能基于它生成精简版。

### Agent配置

#### Agent 1: 三命通會解读方法完整性检查

**输入**：

- 原文：`/Users/lexuanzhang/code/tarot_agent/database/chinese_extracted_books/三命通會/`
- 完整解读方法：`/Users/lexuanzhang/code/tarot_agent/database/chinese_book_analysis/解读方法/三命通會.md`

**任务**：

1. 完整阅读原文（逐章逐节，不遗漏）
2. 完整阅读解读方法文档（完整版）
3. 对照检查：
    - 解读方法的每个步骤是否有明确的原文依据
    - 原文中的重要判断逻辑是否都在解读方法中
    - 解读方法的描述是否清晰可执行
    - 是否缺少关键步骤或判断条件
4. 标注问题类型：
    - 🔍 模糊描述：方法描述不够清晰，难以操作化（给出原文位置和改进建议）
    - 📌 缺少依据：方法在原文中找不到明确依据（标注方法描述和原文搜索范围）
    - ⚠️ 缺失方法：原文有的判断逻辑，解读方法文档未包含（标注原文位置）
    - ✏️ 描述不准确：方法描述与原文有偏差（标注原文和解读方法的差异）
5. 生成详细报告
6. **如有问题，直接修正完整版解读方法文档**

**输出**：`phase1_三命通會_完整性检查报告.md`

#### Agent 2: 淵海子平解读方法完整性检查

**任务**：同Agent 1，针对淵海子平  
**输出**：`phase1_淵海子平_完整性检查报告.md`

#### Agent 3: 滴天髓闡微解读方法完整性检查

**任务**：同Agent 1，针对滴天髓闡微  
**输出**：`phase1_滴天髓闡微_完整性检查报告.md`

#### Agent 4: 窮通寶鑒解读方法完整性检查

**任务**：同Agent 1，针对窮通寶鑒  
**输出**：`phase1_窮通寶鑒_完整性检查报告.md`

#### Review Agent 1A: 第一轮审查

**输入**：4份完整性检查报告

**任务**：

1. 审查4份完整性检查报告
2. 评估问题识别的充分性和准确性
3. 验证原文依据的准确性（抽查）
4. 识别可能遗漏的问题
5. 评估修正建议的合理性

**输出**：`phase1_review_1A_报告.md`

#### Review Agent 1B: 第二轮独立审查

**输入**：4份报告 + Review 1A报告

**任务**：

1. 独立审查，重点关注高严重度问题
2. 抽查验证：随机选择每本书5个原文依据标注，验证准确性
3. 评估修正建议的可执行性
4. 对比两轮review结论
5. 给出最终通过/不通过决定

**输出**：`phase1_review_1B_报告.md` + `phase1_综合完整性验证报告.md`

### 通过标准

**强制要求**：

- ✅ 所有高严重度问题（📌缺少依据、⚠️缺失方法）都已识别并给出修正方案
- ✅ 每个问题都有原文位置标注（文件名+行号/章节）
- ✅ 原文依据标注的抽查准确率 ≥ 95%
- ✅ 没有遗漏原文中的核心判断逻辑
- ✅ **完整版解读方法文档已根据发现的问题进行修正**

**不通过处理**：

- 如未达标，明确指出具体缺陷
- 分配修正Agent重新检查
- 重新进行两轮review直到通过

---

## Phase 2: 精简版文档生成与验证

### 目标

基于Phase 1已验证和修正的完整版解读方法，生成或验证精简版文档的准确性。

### Agent配置

#### Agent 5: 三命通會精简版生成/验证

**输入**：

- 完整版（已修正）：`/Users/lexuanzhang/code/tarot_agent/database/chinese_book_analysis/解读方法/三命通會.md`
- 精简版（如存在）：`/Users/lexuanzhang/code/tarot_agent/database/chinese_book_analysis/解读方法/三命通會_精炼版.md`

**任务**：

1. 完整阅读已修正的完整版解读方法
2. 如果精简版存在：
    - 对照完整版，检查精简版是否准确提取核心要点
    - 验证精简版没有遗漏关键方法
    - 验证精简版没有曲解原意
3. 如果精简版不存在或需要重新生成：
    - 基于完整版生成新的精简版
    - 确保提取所有核心方法
    - 保持原意，语言简洁
4. 标注问题类型：
    - ✅ 完全对应：精简版方法X对应完整版内容，描述准确
    - ⚠️ 描述模糊：完整版说"..."，精简版说"..."，存在理解差异
    - ❌ 遗漏方法：完整版有的方法，精简版未包含
    - ✏️ 描述不准确：精简版曲解了完整版的原意
5. 生成验证报告
6. **更新或创建精简版文档**

**输出**：`phase2_三命通會_精简版验证报告.md` + 更新的精简版文档

#### Agent 6: 淵海子平精简版生成/验证

**任务**：同Agent 5，针对淵海子平  
**输出**：`phase2_淵海子平_精简版验证报告.md` + 更新的精简版文档

#### Agent 7: 滴天髓闡微精简版生成/验证

**任务**：同Agent 5，针对滴天髓闡微  
**输出**：`phase2_滴天髓闡微_精简版验证报告.md` + 更新的精简版文档

#### Agent 8: 窮通寶鑒精简版生成/验证

**任务**：同Agent 5，针对窮通寶鑒  
**输出**：`phase2_窮通寶鑒_精简版验证报告.md` + 更新的精简版文档

#### Review Agent 2A: 第一轮审查

**输入**：4份精简版验证报告

**任务**：

1. 审查4份验证报告的完整性
2. 验证所有问题都已标注
3. 识别共性问题和个性问题
4. 评估验证质量是否达标
5. 如不达标，给出具体可执行的改进要求

**输出**：`phase2_review_2A_报告.md`

#### Review Agent 2B: 第二轮独立审查

**输入**：4份验证报告 + Review 2A报告

**任务**：

1. 独立于Review Agent 2A进行审查
2. 重点关注Review Agent 2A可能遗漏的问题
3. 抽查验证：随机选择10个精简版内容，对照完整版验证准确性
4. 对比两轮review的结论
5. 给出最终是否通过的决定

**输出**：`phase2_review_2B_报告.md` + `phase2_精简版综合验证报告.md`

### 通过标准

**强制要求**：

- ✅ Review Agent 2A和2B都确认：精简版准确提取了完整版的核心要点
- ✅ 高严重度问题（❌遗漏方法 和 ✏️描述不准确）≤ 3个/每本书
- ✅ 所有高严重度问题都有具体可执行的修正建议
- ✅ **精简版文档已更新/创建完成**

**不通过处理**：

- 如未达标，明确指出哪些问题未解决
- 分配修正Agent重新验证
- 重新进行两轮review直到通过

---

## Phase 3: 解读方法冲突与差异分析

### 目标

系统分析四书解读方法的冲突和差异，为综合解读架构提供依据。

### Agent配置

#### Agent 9: 四书解读方法综合分析

**输入**：四个精炼版解读方法文档

**任务**：

1. 完整阅读四个精炼版解读方法文档
2. 系统对比分析（11个维度）：
    - 维度1: 核心理念差异
    - 维度2: 用神取法冲突
    - 维度3: 格局判断标准差异
    - 维度4: 大运流年分析方法差异
    - 维度5: 特殊理论差异
    - 维度6: 六亲判断方法差异
    - 维度7: 疾病健康判断差异
    - 维度8: 性格判断差异
    - 维度9: 富贵贫贱判断标准差异
    - 维度10: 时辰精度要求差异
    - 维度11: 排盘基础信息需求差异
3. 构建冲突矩阵
4. 典型冲突案例深度分析（至少10个）
5. 识别共识点
6. 批判性思考

**输出**：`phase3_四书冲突与差异综合分析报告.md`

#### Review Agent 3A & 3B

双重独立审查机制。

**输出**：`phase3_review_3A_报告.md`、`phase3_review_3B_报告.md`、`phase3_冲突分析最终报告.md`

### 通过标准

**强制要求**：

- ✅ 识别的核心冲突 ≥ 20个，每个都有具体案例说明
- ✅ 11个对比维度都有深入分析，不是表面描述
- ✅ 冲突分析深入到理念层面和适用边界
- ✅ 两个Review Agent对冲突识别的一致性 ≥ 80%
- ✅ 批判性分析充分

---

## Phase 4: 综合解读架构设计

### 目标

设计详细的解读架构，说明如何整合四书方法进行八字解读。

### 前置工作：代码架构分析与解读模块规划

#### Agent 10: 当前代码架构分析

**输入**：`/Users/lexuanzhang/code/tarot_agent/`（整个代码库）

**分析重点**：

- 当前项目结构
- 现有模块化方式
- 公共工具函数的组织
- 数据结构定义的位置
- 配置文件的管理
- 四本书相关代码的组织方式（如果已有）

**输出**：`phase4_当前代码架构分析报告.md`

#### Agent 11: 解读模块规划

**输入**：

- Agent 10的代码架构分析
- 四个精炼版解读方法

**任务**：

1. 基于Agent 10的代码架构分析
2. 完整阅读四个精炼版解读方法
3. 设计模块化的解读架构
4. **设计两阶段交互流程**：
    - **Stage 1: 排盘阶段**（用户输入基本信息 → 系统输出完整排盘结果）
    - **Stage 2: 解读/问答阶段**（完整解读 或 问答模式）

**输出**：`phase4_解读模块规划与代码架构设计.md`

### 核心模块详细设计

#### Agent 12-21: 各模块详细设计（10个核心模块）

每个Agent负责一个核心模块，**必须输出以下8部分内容**：

1. 模块职责
2. 四书方法对比
3. 输入数据
4. 处理流程（伪代码+Mermaid流程图）
5. 输出数据结构
6. RAG需求标注（为Phase 5准备）
7. 冲突解决策略
8. 测试案例

**核心模块分配**：

- **Agent 12**: 排盘模块设计（Stage 1）
- **Agent 13**: 日主旺衰判断模块
- **Agent 14**: 格局判断模块
- **Agent 15**: 用神选取模块
- **Agent 16**: 调候分析模块
- **Agent 17**: 体用配置模块
- **Agent 18**: 旺衰颠倒判断模块
- **Agent 19**: 六亲判断模块
- **Agent 20**: 大运流年分析模块
- **Agent 21**: 冲突识别、解决与综合判断模块

**输出**：每个agent一份详细设计报告

#### Review Agent 4A & 4B

**输出**：`phase4_review_4A_报告.md`、`phase4_review_4B_报告.md`、`phase4_解读架构最终设计文档.md`

### 通过标准

- ✅ 所有10个核心模块都有完整的8部分设计
- ✅ 每个模块都有清晰的输入/输出数据结构定义
- ✅ RAG需求点标注完整
- ✅ 模块间数据流清晰，没有循环依赖
- ✅ 两个Review Agent都确认：模块设计可执行，逻辑正确

---

## Phase 5: RAG系统架构设计

### 目标

基于Phase 4的解读架构设计，针对每个解读步骤中需要RAG搜索的地方，设计RAG数据结构和查询机制。

### Agent配置

#### Agent 22: RAG需求综合分析

**输入**：

- `phase4_解读架构最终设计文档.md`
- 10个模块设计报告（含RAG需求点标注）

**任务**：

1. 提取所有RAG需求点
2. 分析查询特征
3. 生成RAG需求统计

**输出**：`phase5_RAG需求综合分析报告.md`

#### Agent 23-26: 四书数据分割与结构设计

**任务**（以Agent 23为例）：

1. 完整阅读原文分析
2. 基于RAG需求的分割策略设计
3. Chunk设计
4. 索引策略
5. 特殊内容标注
6. 数据统计

**Agent 23**: 三命通會数据分割设计  
**Agent 24**: 淵海子平数据分割设计  
**Agent 25**: 滴天髓闡微数据分割设计  
**Agent 26**: 窮通寶鑒数据分割设计

**输出**：每个agent一份数据分割设计报告

#### Agent 27: RAG查询流程设计

**输入**：

- `phase5_RAG需求综合分析报告.md`
- 四份数据分割设计报告
- `phase4_解读架构最终设计文档.md`

**任务**：

1. 设计查询流程
2. 查询优化策略
3. 缓存机制

**输出**：`phase5_RAG查询流程设计.md`

#### Review Agent 5A & 5B

**Review Agent 5B特殊任务**：批判性审查 + 模拟解读场景测试

**输出**：`phase5_review_5A_报告.md`、`phase5_review_5B_批判性审查报告.md`、`phase5_RAG系统设计最终文档.md`

### 通过标准

- ✅ 所有解读步骤都有对应的RAG支持（没有查询盲点）
- ✅ 数据分割方案不破坏原文完整性
- ✅ 查询机制能准确检索到需要的内容（3个模拟测试的RAG查询成功率 ≥ 90%）
- ✅ 批判性审查通过
- ✅ 模拟测试识别的所有查询盲点都有解决方案

---

## Phase 6: 成本优化方案

### 目标

在保证统一完整分析的前提下，基于真实数据计算token消耗，设计智能优化策略。

### Agent配置

#### Agent 28: Token使用真实计算（统一分析模式）

**任务**：

1. 选择3个不同复杂度的命局（简单、中等、复杂各一个）
2. 对每个命局进行完整解读模拟并计算token
3. 成本估算（基于GPT-4o pricing）

**输出**：`phase6_统一分析Token真实消耗.md`

#### Agent 29: 智能路由与查询优化

**任务**：

1. 智能路由机制
2. 查询结果复用
3. 批量查询优化

**输出**：`phase6_智能路由优化策略.md`

#### Agent 30: 问答模式优化

**任务**：

1. 问题分类路由
2. Context管理
3. 预加载机制

**输出**：`phase6_问答模式优化策略.md`

#### Review Agent 6: 成本优化方案审查

**输出**：`phase6_成本优化审查报告.md`

### 通过标准

- ✅ Token计算基于真实完整分析流程
- ✅ 优化策略不影响分析完整性
- ✅ 智能路由策略合理
- ✅ 问答模式设计清晰可执行

---

## 项目执行时间表

|Phase|Agent数|预计时间|关键里程碑|
|---|---|---|---|
|Phase 1|6 (4+2R)|120分钟|**完整版验证报告**（与原文对照）|
|Phase 2|6 (4+2R)|60分钟|**精简版验证报告**（基于完整版）|
|Phase 3|3 (1+2R)|60分钟|冲突分析报告|
|Phase 4|14 (2+10+2R)|210分钟|解读架构设计文档|
|Phase 5|8 (1+4+1+2R)|150分钟|RAG系统设计文档|
|Phase 6|4 (3+1R)|60分钟|成本优化方案|
|**总计**|**41 agents**|**~11小时**|**完整系统**|

---

## 最终交付物清单

### Phase 1 交付物（7份）

- [ ]  `phase1_三命通會_完整性检查报告.md`
- [ ]  `phase1_淵海子平_完整性检查报告.md`
- [ ]  `phase1_滴天髓闡微_完整性检查报告.md`
- [ ]  `phase1_窮通寶鑒_完整性检查报告.md`
- [ ]  `phase1_review_1A_报告.md`
- [ ]  `phase1_review_1B_报告.md`
- [ ]  `phase1_综合完整性验证报告.md`

### Phase 2 交付物（7份）

- [ ]  `phase2_三命通會_精简版验证报告.md`
- [ ]  `phase2_淵海子平_精简版验证报告.md`
- [ ]  `phase2_滴天髓闡微_精简版验证报告.md`
- [ ]  `phase2_窮通寶鑒_精简版验证报告.md`
- [ ]  `phase2_review_2A_报告.md`
- [ ]  `phase2_review_2B_报告.md`
- [ ]  `phase2_精简版综合验证报告.md`

### Phase 3 交付物（4份）

- [ ]  `phase3_四书冲突与差异综合分析报告.md`
- [ ]  `phase3_review_3A_报告.md`
- [ ]  `phase3_review_3B_报告.md`
- [ ]  `phase3_冲突分析最终报告.md`

### Phase 4 交付物（14份）

- [ ]  `phase4_当前代码架构分析报告.md`
- [ ]  `phase4_解读模块规划与代码架构设计.md`
- [ ]  `phase4_排盘模块详细设计.md` (Agent 12)
- [ ]  `phase4_日主旺衰判断模块详细设计.md` (Agent 13)
- [ ]  `phase4_格局判断模块详细设计.md` (Agent 14)
- [ ]  `phase4_用神选取模块详细设计.md` (Agent 15)
- [ ]  `phase4_调候分析模块详细设计.md` (Agent 16)
- [ ]  `phase4_体用配置模块详细设计.md` (Agent 17)
- [ ]  `phase4_旺衰颠倒判断模块详细设计.md` (Agent 18)
- [ ]  `phase4_六亲判断模块详细设计.md` (Agent 19)
- [ ]  `phase4_大运流年分析模块详细设计.md` (Agent 20)
- [ ]  `phase4_冲突解决与综合判断模块详细设计.md` (Agent 21)
- [ ]  `phase4_review_4A_报告.md`
- [ ]  `phase4_review_4B_报告.md`
- [ ]  `phase4_解读架构最终设计文档.md`

### Phase 5 交付物（9份）

- [ ]  `phase5_RAG需求综合分析报告.md`
- [ ]  `phase5_三命通會_数据分割设计.md`
- [ ]  `phase5_淵海子平_数据分割设计.md`
- [ ]  `phase5_滴天髓闡微_数据分割设计.md`
- [ ]  `phase5_窮通寶鑒_数据分割设计.md`
- [ ]  `phase5_RAG查询流程设计.md`
- [ ]  `phase5_review_5A_报告.md`
- [ ]  `phase5_review_5B_批判性审查报告.md`
- [ ]  `phase5_RAG系统设计最终文档.md`

### Phase 6 交付物（4份）

- [ ]  `phase6_统一分析Token真实消耗.md`
- [ ]  `phase6_智能路由优化策略.md`
- [ ]  `phase6_问答模式优化策略.md`
- [ ]  `phase6_成本优化审查报告.md`

### 最终交付物（1份）

- [ ]  `最终系统整合报告.md`

**总计**：46份文档

---

## 质量保证机制

### Review层级

1. **Phase内部review**：每个Phase都有2个独立review agent
2. **Phase间review**：后续Phase会验证前序Phase的输出
3. **最终review**：Supervisor Agent进行全局审查

### 失败处理流程

如果某个Phase未通过review：

1. Review Agent明确指出问题
2. Supervisor分配修正任务
3. 重新执行相关agents
4. 重新进行review
5. 直到通过为止（最多重试3次）

---

## User Review Required

IMPORTANT

**请审查本实施计划，重点关注**：

1. ✅ Supervisor Agent设计是否满足自动化执行需求？
2. ✅ 6个Phase的划分和41个agents的配置是否合理？
3. ✅ 每个Phase的通过标准是否清晰可验证？
4. ✅ Review机制（双重审查）是否充分？
5. ✅ 交付物清单（46份文档）是否完整？
6. ✅ 执行时间估算（~11小时）是否合理？

**审查通过后，Supervisor将自动开始执行Phase 1**。