# DD2525 - Lab Assignment 1: Information Flow Control

## 任务概述

这个实验要求你实现一个具有信息流控制（IFC）的在线约会服务，该服务的特点是用户可以精细控制自己的个人资料对其他用户的可见性。你需要使用Troupe语言完成实现，并确定必要的安全标签以及放置合适的降级（declassification）和权限声明。

特点：用户可以提供一段称为"发现代理"（discovery agent）的代码，控制自己的可见性。这些代理在服务器上运行，确定该用户是否希望被特定用户发现，以及其他用户可以看到的个人资料内容。

## 主要组件

1. **约会服务器（Dating Server）**：接收用户个人资料和他们的"发现代理"（discovery agent）
    
2. **客户端**：
    
    - 至少两个良性客户端（benign clients）
    - 至少一个恶意客户端（malicious client），尝试泄露敏感信息

## 文件结构与需要修改的文件

从提供的代码中，你需要完成/修改以下文件：

- `code/dating-server/`目录下的服务器实现文件
    - 完成`server`函数，处理个人资料管理和匹配逻辑
    - 实现必要的权限声明和降级操作
- 创建自己的客户端实现文件
    - 实现至少两个良性客户端，具有不同的个人资料和发现代理
    - 实现至少一个恶意客户端，尝试泄露敏感信息
- 根据需要修改或创建trustmap文件
    - 确保适当的信任关系配置

## 协议规范

通信协议包含两种消息：

1. **客户端到服务器**：`("NEWPROFILE", data)`
    
    - `data`是一个元组`(profile, agent, pid)`
    - `profile`是元组`(lev, name, year, gender, interests)`
        - `lev`：安全级别，标签为`{}`
        - `name`：用户名，标签为`{lev}`
        - `year`：出生年份，标签为`{lev}`
        - `gender`：性别（true为女性），标签为`{lev}`
        - `interests`：兴趣列表，标签为`{lev}`
    - `agent`：发现代理函数，标签为`{}`
    - `pid`：客户端进程ID，标签为`{}`
2. **服务器到客户端**：`("NEWMATCH", profile)`
    
    - `profile`是匹配用户的个人资料

## 发现代理规范

- 每个代理是一个函数，接收另一个用户的个人资料
- 返回元组`(preference, maybeProfile)`
    - `preference`：布尔值，表示是否喜欢该个人资料
    - `maybeProfile`：如果`preference`为false则为`()`，否则为要显示给对方的个人资料
- 返回值的安全标签必须是参数个人资料的`{lev}`级别

## 服务器规范

当两个用户互相匹配时：

- 如果Alice的代理返回`(true, alicesProfileForBob)`，Bob的代理返回`(true, bobsProfileForAlice)`
- 服务器应该向Bob发送`("NEWMATCH", alicesProfileForBob)`
- 服务器应该向Alice发送`("NEWMATCH", bobsProfileForAlice)`
- 如果任一代理返回负面偏好，服务器不应通知任何进程

## 安全需求

实现应该正确处理信息流，使用适当的安全标签确保用户个人资料的可见性受到控制。这意味着：

- 每个级别为ℓ的客户端必须信任服务器到级别ℓ
    - 例如，Alice的客户端必须信任服务器到级别`{alice}`
- 服务器的信任关系必须反映这一点
- 代理函数必须适当地降级信息
- 服务器必须限制其降级操作，仅限于偏好布尔值和个人资料元组的外部标签

## 需要补充的代码

在提供的初始代码中，你需要补充：

1. **服务器代码**:
    
    - 完成`server`函数，处理个人资料和代理函数
    - 实现匹配逻辑，当两个用户互相喜欢时向彼此发送个人资料
    - 添加适当的权限声明（`authority`）和降级操作
    - 处理配置文件的安全标签逻辑
2. **客户端代码**:
    
    - 创建包含个人资料和发现代理的良性客户端
    - 创建尝试泄露敏感信息的恶意客户端
    - 确保适当的安全标签处理

## 已完成的部分

初始代码已经提供：

- 服务器的基础框架
- 消息接收机制
- 服务器注册和与调度器的通信

## 最终成果

最终提交的将是一个ZIP文件，包含：

1. **源代码**：
    - 服务器实现
    - 至少两个良性客户端
    - 至少一个恶意客户端（尝试泄露信息）
2. **报告**：
    - 解决方案的设计方法
    - 服务器和客户端设计的详细说明
    - 安全标签的选择和降级操作的使用
    - 每个小组成员的贡献声明

## 评分标准（最高22分）

- 服务器实现：10分
- 服务器和两个良性客户端实现：15分
- 恶意客户端实现：5分
- 额外的恶意客户端实现：最多2分额外加分

报告必须令人满意，每个小组成员必须能够解释解决方案并在实验演示中回答问题。否则可能会扣分。

## 截止日期

2025年4月9日

## 开始步骤

1. 安装并运行Docker容器中的Troupe
2. 创建网络标识符
3. 了解提供的起始代码
4. 实现服务器和客户端
5. 测试你的实现